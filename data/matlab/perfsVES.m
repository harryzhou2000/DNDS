clear();
Ds = {};
%%
d.machine = 'TH2B';
d.case = 'VES, DMR_480_HLLEpp, nolim';
d.commit = '3810dd9592bcf2fb1641edfe80d8128db7f72797';
d.testLen = '10 internal';
d.shortname = "VES nolim";
d.ncpu = [1 4 16 1*24 4*24];
d.t = [ ...
    mean([120.999, 120.592,120.596,120.564]),...
    mean([63.988, 63.935 ,63.464,63.747]),...
    mean([32.806,32.896,32.657,32.999]),...
    mean([17.935,17.886,17.860,17.867]),...
    mean([3.18609,...
3.41163,...
3.57943,...
3.67211,...
3.60624,...
3.55656,...
3.45067,...
3.45609,...
3.56142,...
3.65981,...
3.65046,...
3.57219,...
3.52643,...
3.49405,...
3.49625,...
3.54407,...
3.66266,...
3.79282,...
3.87055,...
 3.8801,...
3.83519,...
3.80577,...
3.87276,...
3.91958,...
3.90352,...
3.76739,...
3.64517,...
3.63732,...
3.62783,...
3.64277,...
3.69575,...
 3.8048,...
3.87056,...
3.92684,...
3.96017,...
 3.9536,...
3.91266,...
3.85261,...
 3.8444]),...
    ];
fprintf("%s, perfmax = %g\n",d.case,d.t(end));

spvflop = 10./(d.ncpu.*d.t);

plot(d.ncpu,spvflop/spvflop(1),'o','DisplayName','FullLim TH2B');
set(gca,'XScale','log');
ylim([0,inf]);
Ds{end + 1} = d;

%%
d.machine = 'TH2B';
d.case = 'DNDS, DMR_480_HLLEpp, nolim';
d.commit = '3810dd9592bcf2fb1641edfe80d8128db7f72797';
d.testLen = '10 internal';
d.shortname = "DNDS nolim";
d.ncpu = [1 4 16 1*24 4*24];
d.t = [ ...
    mean([120.999, 120.592,120.596,120.564]),...
    mean([63.988, 63.935 ,63.464,63.747]),...
    mean([32.806,32.896,32.657,32.999]),...
    mean([17.935,17.886,17.860,17.867]),...
    mean([3.267,...
3.316,...
3.249,...
3.400,...
3.417,...
3.310,...
3.211,...
3.254,...
3.406,...
3.522,...
3.577,...
3.550,...
3.489,...
3.511,...
3.530,...
3.556,...
3.646,...
3.708,...
3.751,...
3.767,...
3.752,...
3.764,...
3.789,...
3.802,...
3.808,...
3.806,...
3.809,...
3.795,...
3.818,...
3.843,...
3.860,...
3.879,...
3.889,...
3.900,...
3.911,...
3.918,...
3.927,...
3.938,...
3.940]),...
    ];
fprintf("%s, perfmax = %g\n",d.case,d.t(end));

spvflop = 10./(d.ncpu.*d.t);

plot(d.ncpu,spvflop/spvflop(1),'o','DisplayName','FullLim TH2B');
set(gca,'XScale','log');
ylim([0,inf]);
Ds{end + 1} = d;
%%
d.machine = 'TH2B';
d.case = 'DNDS2D, DMR_480_HLLEpp, nolim';
d.commit = '3810dd9592bcf2fb1641edfe80d8128db7f72797';
d.testLen = '10 internal';
d.shortname = "DNDS2D nolim";
d.ncpu = [1 4 16 1*24 4*24];
d.t = [ ...
    mean([120.999, 120.592,120.596,120.564]),...
    mean([63.988, 63.935 ,63.464,63.747]),...
    mean([32.806,32.896,32.657,32.999]),...
    mean([17.935,17.886,17.860,17.867]),...
    mean([3.109,...
3.168,...
3.096,...
3.233,...
3.244,...
3.135,...
3.037,...
3.084,...
3.237,...
3.350,...
3.403,...
3.375,...
3.314,...
3.330,...
3.348,...
3.378,...
3.466,...
3.526,...
3.558,...
3.569,...
3.578,...
3.591,...
3.616,...
3.631,...
3.635,...
3.636,...
3.627,...
3.631,...
3.671,...
3.681,...
3.698,...
3.714,...
3.726,...
3.736,...
3.747,...
3.754,...
3.776,...
3.772,...
3.775]),...
    ];
fprintf("%s, perfmax = %g\n",d.case,d.t(end));

spvflop = 10./(d.ncpu.*d.t);

plot(d.ncpu,spvflop/spvflop(1),'o','DisplayName','FullLim TH2B');
set(gca,'XScale','log');
ylim([0,inf]);
Ds{end + 1} = d;
%%
d.machine = 'TH2B';
d.case = 'VES, DMR_480_HLLEpp, limall';
d.commit = '3810dd9592bcf2fb1641edfe80d8128db7f72797';
d.testLen = '10 internal';
d.shortname = "VES fulllim";
d.ncpu = [1 4 16 1*24 4*24];
d.t = [ ...
    mean([120.999, 120.592,120.596,120.564]),...
    mean([63.988, 63.935 ,63.464,63.747]),...
    mean([32.806,32.896,32.657,32.999]),...
    mean([17.935,17.886,17.860,17.867]),...
    mean([  12.5516,...
  12.8265,...
  13.1038,...
  13.2585,...
  13.239,...
  13.2205,...
  13.161,...
  13.1676,...
  13.2867,...
  13.3996,...
   13.3988,...
   13.3229,...
   13.2752,...
   13.2228,...
   13.2368,...
   13.3006,...
   13.4007,...
 13.5225,...
   13.6197,...
   13.6107,...
   13.5469,...
   13.5235,...
   13.5888,...
   13.6311,...
   13.6237,...
   13.4912,...
   13.3791,...
   13.3907,...
   13.3791,...
   13.4023,...
  13.4187,...
   13.5166,...
   13.6028,...
  13.6536,...
   13.6863,...
   13.6992,...
   13.6533,...
   13.5971,...
 13.5957]),...
    ];
fprintf("%s, perfmax = %g\n",d.case,d.t(end));

spvflop = 10./(d.ncpu.*d.t);

plot(d.ncpu,spvflop/spvflop(1),'o','DisplayName','FullLim TH2B');
set(gca,'XScale','log');
ylim([0,inf]);
Ds{end + 1} = d;
%%
d.machine = 'TH2B';
d.shortname = "DNDS2D fulllim";
d.case = 'DNDS2D, DMR_480_HLLEpp, limall';
d.commit = '3810dd9592bcf2fb1641edfe80d8128db7f72797';
d.testLen = '10 internal';
d.ncpu = [1 4 16 1*24 4*24];
d.t = [ ...
    mean([120.999, 120.592,120.596,120.564]),...
    mean([63.988, 63.935 ,63.464,63.747]),...
    mean([32.806,32.896,32.657,32.999]),...
    mean([17.935,17.886,17.860,17.867]),...
    mean([10.117,...
9.842,...
9.932,...
10.190,...
10.068,...
9.715,...
9.640,...
10.003,...
10.462,...
10.903,...
11.091,...
10.926,...
10.555,...
10.642,...
10.822,...
11.052,...
11.275,...
11.412,...
11.442,...
11.412,...
11.342,...
11.364,...
11.545,...
11.675,...
11.768,...
11.829,...
11.850,...
11.890,...
11.933,...
11.976,...
11.987,...
12.009,...
12.014,...
12.023,...
12.040,...
12.040,...
12.066,...
12.094,...
12.101
]),...
    ];
fprintf("%s, perfmax = %g\n",d.case,d.t(end));

spvflop = 10./(d.ncpu.*d.t);

plot(d.ncpu,spvflop/spvflop(1),'o','DisplayName','FullLim TH2B');
set(gca,'XScale','log');
ylim([0,inf]);
Ds{end + 1} = d;

%% DRAW Ds
Names = {};
datas = [];
for i = 1:numel(Ds)
    d = Ds{i};
    datas(end + 1) = d.t(end);
    Names{end + 1} = d.shortname;
end

b = bar(datas,'white','CData',[0,0,0,0,1]);
xticklabels(Names);
ytickformat("%d");
xtips = b.XEndPoints;
ytips = b.YEndPoints;
text(xtips,ytips, string(datas),'HorizontalAlignment','center',...
    'VerticalAlignment','bottom');
ylabel('time(s)');

%%
Total_Lim_Detector = [12.7976,5.148+12.7976-8.629,12.7976-8.629];
Other_LimM_Detector = [Total_Lim_Detector(1)-Total_Lim_Detector(2),Total_Lim_Detector(2)-Total_Lim_Detector(3),Total_Lim_Detector(3)]
Names = ["Others (RHS, Rec, LUSGS)", "Limiter (FULL)", "DisDetector"] + " " + compose("%.1f%%",Other_LimM_Detector/sum(Other_LimM_Detector)*100);

pie(Other_LimM_Detector,Names);
colormap("hot");
%%
Lines = [46819, 20913 - 1627];
Names = ["VES serial", "DNDS"];

b = bar(Lines);
xticklabels(Names);
ytickformat("%d");
xtips = b.XEndPoints;
ytips = b.YEndPoints;
text(xtips,ytips, string(Lines),'HorizontalAlignment','center',...
    'VerticalAlignment','bottom');
ylabel('lines');



